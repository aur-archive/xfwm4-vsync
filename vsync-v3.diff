diff --git a/xfwm4-4.10.0/defaults/defaults b/xfwm4-4.10.0/defaults/defaults
index 6db210a..17dc3d7 100644
--- a/xfwm4-4.10.0/defaults/defaults
+++ b/xfwm4-4.10.0/defaults/defaults
@@ -49,6 +49,7 @@ snap_resist=false
 snap_to_border=true
 snap_to_windows=false
 snap_width=10
+sync_to_vblank=false
 theme=Default
 tile_on_move=true
 title_alignment=center
diff --git a/xfwm4-4.10.0/settings-dialogs/tweaks-settings.c b/xfwm4-4.10.0/settings-dialogs/tweaks-settings.c
index f60b606..0c7cd4e 100644
--- a/xfwm4-4.10.0/settings-dialogs/tweaks-settings.c
+++ b/xfwm4-4.10.0/settings-dialogs/tweaks-settings.c
@@ -205,6 +205,7 @@ wm_tweaks_dialog_configure_widgets (GtkBuilder *builder)
     GtkWidget *show_frame_shadow_check = GTK_WIDGET (gtk_builder_get_object (builder, "show_frame_shadow_check"));
     GtkWidget *show_popup_shadow_check = GTK_WIDGET (gtk_builder_get_object (builder, "show_popup_shadow_check"));
     GtkWidget *show_dock_shadow_check = GTK_WIDGET (gtk_builder_get_object (builder, "show_dock_shadow_check"));
+    GtkWidget *sync_to_vblank_check = GTK_WIDGET (gtk_builder_get_object (builder, "sync_to_vblank_check"));
 
     GtkWidget *frame_opacity_scale = GTK_WIDGET (gtk_builder_get_object (builder, "frame_opacity_scale"));
     GtkWidget *inactive_opacity_scale = GTK_WIDGET (gtk_builder_get_object (builder, "inactive_opacity_scale"));
@@ -405,6 +406,10 @@ wm_tweaks_dialog_configure_widgets (GtkBuilder *builder)
                             "/general/show_dock_shadow",
                             G_TYPE_BOOLEAN,
                             (GObject *)show_dock_shadow_check, "active");
+    xfconf_g_property_bind (xfwm4_channel,
+                            "/general/sync_to_vblank",
+                            G_TYPE_BOOLEAN,
+                            (GObject *)sync_to_vblank_check, "active");
 
     xfconf_g_property_bind (xfwm4_channel,
                             "/general/frame_opacity",
diff --git a/xfwm4-4.10.0/settings-dialogs/xfwm4-tweaks-dialog.glade b/xfwm4-4.10.0/settings-dialogs/xfwm4-tweaks-dialog.glade
index bd2a86f..10b0a72 100644
--- a/xfwm4-4.10.0/settings-dialogs/xfwm4-tweaks-dialog.glade
+++ b/xfwm4-4.10.0/settings-dialogs/xfwm4-tweaks-dialog.glade
@@ -773,6 +773,20 @@ when switching via keyboard shortcuts</property>
                                   </packing>
                                 </child>
                                 <child>
+                                  <object class="GtkCheckButton" id="sync_to_vblank">
+                                    <property name="label" translatable="yes">Synchronize drawing to the _vertical blank</property>
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">True</property>
+                                    <property name="receives_default">False</property>
+                                    <property name="use_underline">True</property>
+                                    <property name="draw_indicator">True</property>
+                                  </object>
+                                  <packing>
+                                    <property name="expand">False</property>
+                                    <property name="position">4</property>
+                                  </packing>
+                                </child>
+                                <child>
                                   <object class="GtkLabel" id="label12">
                                     <property name="visible">True</property>
                                     <property name="xalign">0</property>
@@ -782,7 +796,7 @@ when switching via keyboard shortcuts</property>
                                   </object>
                                   <packing>
                                     <property name="expand">False</property>
-                                    <property name="position">4</property>
+                                    <property name="position">5</property>
                                   </packing>
                                 </child>
                                 <child>
@@ -836,7 +850,7 @@ when switching via keyboard shortcuts</property>
                                   <packing>
                                     <property name="expand">False</property>
                                     <property name="fill">False</property>
-                                    <property name="position">5</property>
+                                    <property name="position">6</property>
                                   </packing>
                                 </child>
                                 <child>
@@ -850,7 +864,7 @@ when switching via keyboard shortcuts</property>
                                   <packing>
                                     <property name="expand">False</property>
                                     <property name="fill">False</property>
-                                    <property name="position">6</property>
+                                    <property name="position">7</property>
                                   </packing>
                                 </child>
                                 <child>
@@ -904,7 +918,7 @@ when switching via keyboard shortcuts</property>
                                   <packing>
                                     <property name="expand">False</property>
                                     <property name="fill">False</property>
-                                    <property name="position">7</property>
+                                    <property name="position">8</property>
                                   </packing>
                                 </child>
                                 <child>
@@ -918,7 +932,7 @@ when switching via keyboard shortcuts</property>
                                   <packing>
                                     <property name="expand">False</property>
                                     <property name="fill">False</property>
-                                    <property name="position">8</property>
+                                    <property name="position">9</property>
                                   </packing>
                                 </child>
                                 <child>
@@ -972,7 +986,7 @@ when switching via keyboard shortcuts</property>
                                   <packing>
                                     <property name="expand">False</property>
                                     <property name="fill">False</property>
-                                    <property name="position">9</property>
+                                    <property name="position">10</property>
                                   </packing>
                                 </child>
                                 <child>
@@ -986,7 +1000,7 @@ when switching via keyboard shortcuts</property>
                                   <packing>
                                     <property name="expand">False</property>
                                     <property name="fill">False</property>
-                                    <property name="position">10</property>
+                                    <property name="position">11</property>
                                   </packing>
                                 </child>
                                 <child>
@@ -1040,7 +1054,7 @@ when switching via keyboard shortcuts</property>
                                   <packing>
                                     <property name="expand">False</property>
                                     <property name="fill">False</property>
-                                    <property name="position">11</property>
+                                    <property name="position">12</property>
                                   </packing>
                                 </child>
                                 <child>
@@ -1054,7 +1068,7 @@ when switching via keyboard shortcuts</property>
                                   <packing>
                                     <property name="expand">False</property>
                                     <property name="fill">False</property>
-                                    <property name="position">12</property>
+                                    <property name="position">13</property>
                                   </packing>
                                 </child>
                                 <child>
@@ -1108,7 +1122,7 @@ when switching via keyboard shortcuts</property>
                                   <packing>
                                     <property name="expand">False</property>
                                     <property name="fill">False</property>
-                                    <property name="position">13</property>
+                                    <property name="position">14</property>
                                   </packing>
                                 </child>
                               </object>
diff --git a/xfwm4-4.10.0/settings-dialogs/xfwm4-tweaks-dialog_ui.h b/xfwm4-4.10.0/settings-dialogs/xfwm4-tweaks-dialog_ui.h
index a6121dd..9418ca9 100644
--- a/xfwm4-4.10.0/settings-dialogs/xfwm4-tweaks-dialog_ui.h
+++ b/xfwm4-4.10.0/settings-dialogs/xfwm4-tweaks-dialog_ui.h
@@ -386,187 +386,194 @@ static const char tweaks_dialog_ui[] =
   "eceives_default\">False</property><property name=\"use_underline\">True"
   "</property><property name=\"draw_indicator\">True</property></object><p"
   "acking><property name=\"expand\">False</property><property name=\"posit"
-  "ion\">3</property></packing></child><child><object class=\"GtkLabel\" i"
-  "d=\"label12\"><property name=\"visible\">True</property><property name="
-  "\"xalign\">0</property><property name=\"label\" translatable=\"yes\">Op"
-  "aci_ty of window decorations:</property><property name=\"use_underline\""
-  ">True</property><property name=\"mnemonic_widget\">frame_opacity_scale<"
-  "/property></object><packing><property name=\"expand\">False</property><"
-  "property name=\"position\">4</property></packing></child><child><object"
-  " class=\"GtkAlignment\" id=\"alignment5\"><property name=\"visible\">Tr"
-  "ue</property><property name=\"top_padding\">2</property><property name="
-  "\"left_padding\">12</property><child><object class=\"GtkHBox\" id=\"hbo"
-  "x3\"><property name=\"visible\">True</property><child><object class=\"G"
-  "tkLabel\" id=\"label17\"><property name=\"visible\">True</property><pro"
-  "perty name=\"label\" translatable=\"yes\">&lt;i&gt;Transparent&lt;/i&gt"
-  ";</property><property name=\"use_markup\">True</property></object><pack"
-  "ing><property name=\"expand\">False</property><property name=\"fill\">F"
-  "alse</property><property name=\"position\">0</property></packing></chil"
-  "d><child><object class=\"GtkHScale\" id=\"frame_opacity_scale\"><proper"
-  "ty name=\"visible\">True</property><property name=\"can_focus\">True</p"
-  "roperty><property name=\"update_policy\">discontinuous</property><prope"
-  "rty name=\"adjustment\">adjustment2</property><property name=\"restrict"
-  "_to_fill_level\">False</property><property name=\"draw_value\">False</p"
-  "roperty></object><packing><property name=\"position\">1</property></pac"
-  "king></child><child><object class=\"GtkLabel\" id=\"label18\"><property"
-  " name=\"visible\">True</property><property name=\"label\" translatable="
-  "\"yes\">&lt;i&gt;Opaque&lt;/i&gt;</property><property name=\"use_markup"
-  "\">True</property></object><packing><property name=\"expand\">False</pr"
-  "operty><property name=\"fill\">False</property><property name=\"positio"
-  "n\">2</property></packing></child></object></child></object><packing><p"
-  "roperty name=\"expand\">False</property><property name=\"fill\">False</"
-  "property><property name=\"position\">5</property></packing></child><chi"
-  "ld><object class=\"GtkLabel\" id=\"label13\"><property name=\"visible\""
-  ">True</property><property name=\"xalign\">0</property><property name=\""
-  "label\" translatable=\"yes\">Opacity of _inactive windows:</property><p"
-  "roperty name=\"use_underline\">True</property><property name=\"mnemonic"
-  "_widget\">inactive_opacity_scale</property></object><packing><property "
-  "name=\"expand\">False</property><property name=\"fill\">False</property"
-  "><property name=\"position\">6</property></packing></child><child><obje"
-  "ct class=\"GtkAlignment\" id=\"alignment6\"><property name=\"visible\">"
-  "True</property><property name=\"top_padding\">2</property><property nam"
-  "e=\"left_padding\">12</property><child><object class=\"GtkHBox\" id=\"h"
-  "box4\"><property name=\"visible\">True</property><child><object class=\""
-  "GtkLabel\" id=\"label19\"><property name=\"visible\">True</property><pr"
-  "operty name=\"label\" translatable=\"yes\">&lt;i&gt;Transparent&lt;/i&g"
-  "t;</property><property name=\"use_markup\">True</property></object><pac"
-  "king><property name=\"expand\">False</property><property name=\"fill\">"
-  "False</property><property name=\"position\">0</property></packing></chi"
-  "ld><child><object class=\"GtkHScale\" id=\"inactive_opacity_scale\"><pr"
-  "operty name=\"visible\">True</property><property name=\"can_focus\">Tru"
-  "e</property><property name=\"update_policy\">discontinuous</property><p"
-  "roperty name=\"adjustment\">adjustment3</property><property name=\"rest"
-  "rict_to_fill_level\">False</property><property name=\"draw_value\">Fals"
-  "e</property></object><packing><property name=\"position\">1</property><"
-  "/packing></child><child><object class=\"GtkLabel\" id=\"label20\"><prop"
-  "erty name=\"visible\">True</property><property name=\"label\" translata"
-  "ble=\"yes\">&lt;i&gt;Opaque&lt;/i&gt;</property><property name=\"use_ma"
-  "rkup\">True</property></object><packing><property name=\"expand\">False"
-  "</property><property name=\"fill\">False</property><property name=\"pos"
-  "ition\">2</property></packing></child></object></child></object><packin"
-  "g><property name=\"expand\">False</property><property name=\"fill\">Fal"
-  "se</property><property name=\"position\">7</property></packing></child>"
-  "<child><object class=\"GtkLabel\" id=\"label14\"><property name=\"visib"
-  "le\">True</property><property name=\"xalign\">0</property><property nam"
-  "e=\"label\" translatable=\"yes\">Opacity of windows during _move:</prop"
-  "erty><property name=\"use_underline\">True</property><property name=\"m"
-  "nemonic_widget\">move_opacity_scale</property></object><packing><proper"
+  "ion\">3</property></packing></child><child><object class=\"GtkCheckButt"
+  "on\" id=\"sync_to_vblank\"><property name=\"label\" translatable=\"yes\""
+  ">Synchronize drawing to the _vertical blank</property><property name=\""
+  "visible\">True</property><property name=\"can_focus\">True</property><p"
+  "roperty name=\"receives_default\">False</property><property name=\"use_"
+  "underline\">True</property><property name=\"draw_indicator\">True</prop"
+  "erty></object><packing><property name=\"expand\">False</property><prope"
+  "rty name=\"position\">4</property></packing></child><child><object clas"
+  "s=\"GtkLabel\" id=\"label12\"><property name=\"visible\">True</property"
+  "><property name=\"xalign\">0</property><property name=\"label\" transla"
+  "table=\"yes\">Opaci_ty of window decorations:</property><property name="
+  "\"use_underline\">True</property><property name=\"mnemonic_widget\">fra"
+  "me_opacity_scale</property></object><packing><property name=\"expand\">"
+  "False</property><property name=\"position\">5</property></packing></chi"
+  "ld><child><object class=\"GtkAlignment\" id=\"alignment5\"><property na"
+  "me=\"visible\">True</property><property name=\"top_padding\">2</propert"
+  "y><property name=\"left_padding\">12</property><child><object class=\"G"
+  "tkHBox\" id=\"hbox3\"><property name=\"visible\">True</property><child>"
+  "<object class=\"GtkLabel\" id=\"label17\"><property name=\"visible\">Tr"
+  "ue</property><property name=\"label\" translatable=\"yes\">&lt;i&gt;Tra"
+  "nsparent&lt;/i&gt;</property><property name=\"use_markup\">True</proper"
+  "ty></object><packing><property name=\"expand\">False</property><propert"
+  "y name=\"fill\">False</property><property name=\"position\">0</property"
+  "></packing></child><child><object class=\"GtkHScale\" id=\"frame_opacit"
+  "y_scale\"><property name=\"visible\">True</property><property name=\"ca"
+  "n_focus\">True</property><property name=\"update_policy\">discontinuous"
+  "</property><property name=\"adjustment\">adjustment2</property><propert"
+  "y name=\"restrict_to_fill_level\">False</property><property name=\"draw"
+  "_value\">False</property></object><packing><property name=\"position\">"
+  "1</property></packing></child><child><object class=\"GtkLabel\" id=\"la"
+  "bel18\"><property name=\"visible\">True</property><property name=\"labe"
+  "l\" translatable=\"yes\">&lt;i&gt;Opaque&lt;/i&gt;</property><property "
+  "name=\"use_markup\">True</property></object><packing><property name=\"e"
+  "xpand\">False</property><property name=\"fill\">False</property><proper"
+  "ty name=\"position\">2</property></packing></child></object></child></o"
+  "bject><packing><property name=\"expand\">False</property><property name"
+  "=\"fill\">False</property><property name=\"position\">6</property></pac"
+  "king></child><child><object class=\"GtkLabel\" id=\"label13\"><property"
+  " name=\"visible\">True</property><property name=\"xalign\">0</property>"
+  "<property name=\"label\" translatable=\"yes\">Opacity of _inactive wind"
+  "ows:</property><property name=\"use_underline\">True</property><propert"
+  "y name=\"mnemonic_widget\">inactive_opacity_scale</property></object><p"
+  "acking><property name=\"expand\">False</property><property name=\"fill\""
+  ">False</property><property name=\"position\">7</property></packing></ch"
+  "ild><child><object class=\"GtkAlignment\" id=\"alignment6\"><property n"
+  "ame=\"visible\">True</property><property name=\"top_padding\">2</proper"
+  "ty><property name=\"left_padding\">12</property><child><object class=\""
+  "GtkHBox\" id=\"hbox4\"><property name=\"visible\">True</property><child"
+  "><object class=\"GtkLabel\" id=\"label19\"><property name=\"visible\">T"
+  "rue</property><property name=\"label\" translatable=\"yes\">&lt;i&gt;Tr"
+  "ansparent&lt;/i&gt;</property><property name=\"use_markup\">True</prope"
+  "rty></object><packing><property name=\"expand\">False</property><proper"
+  "ty name=\"fill\">False</property><property name=\"position\">0</propert"
+  "y></packing></child><child><object class=\"GtkHScale\" id=\"inactive_op"
+  "acity_scale\"><property name=\"visible\">True</property><property name="
+  "\"can_focus\">True</property><property name=\"update_policy\">discontin"
+  "uous</property><property name=\"adjustment\">adjustment3</property><pro"
+  "perty name=\"restrict_to_fill_level\">False</property><property name=\""
+  "draw_value\">False</property></object><packing><property name=\"positio"
+  "n\">1</property></packing></child><child><object class=\"GtkLabel\" id="
+  "\"label20\"><property name=\"visible\">True</property><property name=\""
+  "label\" translatable=\"yes\">&lt;i&gt;Opaque&lt;/i&gt;</property><prope"
+  "rty name=\"use_markup\">True</property></object><packing><property name"
+  "=\"expand\">False</property><property name=\"fill\">False</property><pr"
+  "operty name=\"position\">2</property></packing></child></object></child"
+  "></object><packing><property name=\"expand\">False</property><property "
+  "name=\"fill\">False</property><property name=\"position\">8</property><"
+  "/packing></child><child><object class=\"GtkLabel\" id=\"label14\"><prop"
+  "erty name=\"visible\">True</property><property name=\"xalign\">0</prope"
+  "rty><property name=\"label\" translatable=\"yes\">Opacity of windows du"
+  "ring _move:</property><property name=\"use_underline\">True</property><"
+  "property name=\"mnemonic_widget\">move_opacity_scale</property></object"
+  "><packing><property name=\"expand\">False</property><property name=\"fi"
+  "ll\">False</property><property name=\"position\">9</property></packing>"
+  "</child><child><object class=\"GtkAlignment\" id=\"alignment7\"><proper"
+  "ty name=\"visible\">True</property><property name=\"top_padding\">2</pr"
+  "operty><property name=\"left_padding\">12</property><child><object clas"
+  "s=\"GtkHBox\" id=\"hbox5\"><property name=\"visible\">True</property><c"
+  "hild><object class=\"GtkLabel\" id=\"label21\"><property name=\"visible"
+  "\">True</property><property name=\"label\" translatable=\"yes\">&lt;i&g"
+  "t;Transparent&lt;/i&gt;</property><property name=\"use_markup\">True</p"
+  "roperty></object><packing><property name=\"expand\">False</property><pr"
+  "operty name=\"fill\">False</property><property name=\"position\">0</pro"
+  "perty></packing></child><child><object class=\"GtkHScale\" id=\"move_op"
+  "acity_scale\"><property name=\"visible\">True</property><property name="
+  "\"can_focus\">True</property><property name=\"update_policy\">discontin"
+  "uous</property><property name=\"adjustment\">adjustment4</property><pro"
+  "perty name=\"restrict_to_fill_level\">False</property><property name=\""
+  "draw_value\">False</property></object><packing><property name=\"positio"
+  "n\">1</property></packing></child><child><object class=\"GtkLabel\" id="
+  "\"label22\"><property name=\"visible\">True</property><property name=\""
+  "label\" translatable=\"yes\">&lt;i&gt;Opaque&lt;/i&gt;</property><prope"
+  "rty name=\"use_markup\">True</property></object><packing><property name"
+  "=\"expand\">False</property><property name=\"fill\">False</property><pr"
+  "operty name=\"position\">2</property></packing></child></object></child"
+  "></object><packing><property name=\"expand\">False</property><property "
+  "name=\"fill\">False</property><property name=\"position\">10</property>"
+  "</packing></child><child><object class=\"GtkLabel\" id=\"label15\"><pro"
+  "perty name=\"visible\">True</property><property name=\"xalign\">0</prop"
+  "erty><property name=\"label\" translatable=\"yes\">Opacity of windows d"
+  "uring resi_ze:</property><property name=\"use_underline\">True</propert"
+  "y><property name=\"mnemonic_widget\">resize_opacity_scale</property></o"
+  "bject><packing><property name=\"expand\">False</property><property name"
+  "=\"fill\">False</property><property name=\"position\">11</property></pa"
+  "cking></child><child><object class=\"GtkAlignment\" id=\"alignment8\"><"
+  "property name=\"visible\">True</property><property name=\"top_padding\""
+  ">2</property><property name=\"left_padding\">12</property><child><objec"
+  "t class=\"GtkHBox\" id=\"hbox6\"><property name=\"visible\">True</prope"
+  "rty><child><object class=\"GtkLabel\" id=\"label23\"><property name=\"v"
+  "isible\">True</property><property name=\"label\" translatable=\"yes\">&"
+  "lt;i&gt;Transparent&lt;/i&gt;</property><property name=\"use_markup\">T"
+  "rue</property></object><packing><property name=\"expand\">False</proper"
+  "ty><property name=\"fill\">False</property><property name=\"position\">"
+  "0</property></packing></child><child><object class=\"GtkHScale\" id=\"r"
+  "esize_opacity_scale\"><property name=\"visible\">True</property><proper"
+  "ty name=\"can_focus\">True</property><property name=\"update_policy\">d"
+  "iscontinuous</property><property name=\"adjustment\">adjustment5</prope"
+  "rty><property name=\"restrict_to_fill_level\">False</property><property"
+  " name=\"draw_value\">False</property></object><packing><property name=\""
+  "position\">1</property></packing></child><child><object class=\"GtkLabe"
+  "l\" id=\"label24\"><property name=\"visible\">True</property><property "
+  "name=\"label\" translatable=\"yes\">&lt;i&gt;Opaque&lt;/i&gt;</property"
+  "><property name=\"use_markup\">True</property></object><packing><proper"
   "ty name=\"expand\">False</property><property name=\"fill\">False</prope"
-  "rty><property name=\"position\">8</property></packing></child><child><o"
-  "bject class=\"GtkAlignment\" id=\"alignment7\"><property name=\"visible"
-  "\">True</property><property name=\"top_padding\">2</property><property "
-  "name=\"left_padding\">12</property><child><object class=\"GtkHBox\" id="
-  "\"hbox5\"><property name=\"visible\">True</property><child><object clas"
-  "s=\"GtkLabel\" id=\"label21\"><property name=\"visible\">True</property"
-  "><property name=\"label\" translatable=\"yes\">&lt;i&gt;Transparent&lt;"
-  "/i&gt;</property><property name=\"use_markup\">True</property></object>"
-  "<packing><property name=\"expand\">False</property><property name=\"fil"
-  "l\">False</property><property name=\"position\">0</property></packing><"
-  "/child><child><object class=\"GtkHScale\" id=\"move_opacity_scale\"><pr"
-  "operty name=\"visible\">True</property><property name=\"can_focus\">Tru"
-  "e</property><property name=\"update_policy\">discontinuous</property><p"
-  "roperty name=\"adjustment\">adjustment4</property><property name=\"rest"
-  "rict_to_fill_level\">False</property><property name=\"draw_value\">Fals"
-  "e</property></object><packing><property name=\"position\">1</property><"
-  "/packing></child><child><object class=\"GtkLabel\" id=\"label22\"><prop"
-  "erty name=\"visible\">True</property><property name=\"label\" translata"
-  "ble=\"yes\">&lt;i&gt;Opaque&lt;/i&gt;</property><property name=\"use_ma"
-  "rkup\">True</property></object><packing><property name=\"expand\">False"
-  "</property><property name=\"fill\">False</property><property name=\"pos"
-  "ition\">2</property></packing></child></object></child></object><packin"
-  "g><property name=\"expand\">False</property><property name=\"fill\">Fal"
-  "se</property><property name=\"position\">9</property></packing></child>"
-  "<child><object class=\"GtkLabel\" id=\"label15\"><property name=\"visib"
-  "le\">True</property><property name=\"xalign\">0</property><property nam"
-  "e=\"label\" translatable=\"yes\">Opacity of windows during resi_ze:</pr"
-  "operty><property name=\"use_underline\">True</property><property name=\""
-  "mnemonic_widget\">resize_opacity_scale</property></object><packing><pro"
-  "perty name=\"expand\">False</property><property name=\"fill\">False</pr"
-  "operty><property name=\"position\">10</property></packing></child><chil"
-  "d><object class=\"GtkAlignment\" id=\"alignment8\"><property name=\"vis"
-  "ible\">True</property><property name=\"top_padding\">2</property><prope"
-  "rty name=\"left_padding\">12</property><child><object class=\"GtkHBox\""
-  " id=\"hbox6\"><property name=\"visible\">True</property><child><object "
-  "class=\"GtkLabel\" id=\"label23\"><property name=\"visible\">True</prop"
-  "erty><property name=\"label\" translatable=\"yes\">&lt;i&gt;Transparent"
-  "&lt;/i&gt;</property><property name=\"use_markup\">True</property></obj"
+  "rty><property name=\"position\">2</property></packing></child></object>"
+  "</child></object><packing><property name=\"expand\">False</property><pr"
+  "operty name=\"fill\">False</property><property name=\"position\">12</pr"
+  "operty></packing></child><child><object class=\"GtkLabel\" id=\"label16"
+  "\"><property name=\"visible\">True</property><property name=\"xalign\">"
+  "0</property><property name=\"label\" translatable=\"yes\">Opacity of po"
+  "pup window_s:</property><property name=\"use_underline\">True</property"
+  "><property name=\"mnemonic_widget\">popup_opacity_scale</property></obj"
   "ect><packing><property name=\"expand\">False</property><property name=\""
-  "fill\">False</property><property name=\"position\">0</property></packin"
-  "g></child><child><object class=\"GtkHScale\" id=\"resize_opacity_scale\""
-  "><property name=\"visible\">True</property><property name=\"can_focus\""
-  ">True</property><property name=\"update_policy\">discontinuous</propert"
-  "y><property name=\"adjustment\">adjustment5</property><property name=\""
-  "restrict_to_fill_level\">False</property><property name=\"draw_value\">"
-  "False</property></object><packing><property name=\"position\">1</proper"
-  "ty></packing></child><child><object class=\"GtkLabel\" id=\"label24\"><"
-  "property name=\"visible\">True</property><property name=\"label\" trans"
-  "latable=\"yes\">&lt;i&gt;Opaque&lt;/i&gt;</property><property name=\"us"
-  "e_markup\">True</property></object><packing><property name=\"expand\">F"
-  "alse</property><property name=\"fill\">False</property><property name=\""
-  "position\">2</property></packing></child></object></child></object><pac"
+  "fill\">False</property><property name=\"position\">13</property></packi"
+  "ng></child><child><object class=\"GtkAlignment\" id=\"alignment9\"><pro"
+  "perty name=\"visible\">True</property><property name=\"top_padding\">2<"
+  "/property><property name=\"left_padding\">12</property><child><object c"
+  "lass=\"GtkHBox\" id=\"hbox7\"><property name=\"visible\">True</property"
+  "><child><object class=\"GtkLabel\" id=\"label25\"><property name=\"visi"
+  "ble\">True</property><property name=\"label\" translatable=\"yes\">&lt;"
+  "i&gt;Transparent&lt;/i&gt;</property><property name=\"use_markup\">True"
+  "</property></object><packing><property name=\"expand\">False</property>"
+  "<property name=\"fill\">False</property><property name=\"position\">0</"
+  "property></packing></child><child><object class=\"GtkHScale\" id=\"popu"
+  "p_opacity_scale\"><property name=\"visible\">True</property><property n"
+  "ame=\"can_focus\">True</property><property name=\"update_policy\">disco"
+  "ntinuous</property><property name=\"adjustment\">adjustment6</property>"
+  "<property name=\"restrict_to_fill_level\">False</property><property nam"
+  "e=\"draw_value\">False</property></object><packing><property name=\"pos"
+  "ition\">1</property></packing></child><child><object class=\"GtkLabel\""
+  " id=\"label26\"><property name=\"visible\">True</property><property nam"
+  "e=\"label\" translatable=\"yes\">&lt;i&gt;Opaque&lt;/i&gt;</property><p"
+  "roperty name=\"use_markup\">True</property></object><packing><property "
+  "name=\"expand\">False</property><property name=\"fill\">False</property"
+  "><property name=\"position\">2</property></packing></child></object></c"
+  "hild></object><packing><property name=\"expand\">False</property><prope"
+  "rty name=\"fill\">False</property><property name=\"position\">14</prope"
+  "rty></packing></child></object></child></object></child></object></chil"
+  "d></object><packing><property name=\"position\">1</property></packing><"
+  "/child></object><packing><property name=\"position\">5</property></pack"
+  "ing></child><child type=\"tab\"><object class=\"GtkLabel\" id=\"label6\""
+  "><property name=\"visible\">True</property><property name=\"label\" tra"
+  "nslatable=\"yes\">C_ompositor</property><property name=\"use_underline\""
+  ">True</property></object><packing><property name=\"position\">5</proper"
+  "ty><property name=\"tab_fill\">False</property></packing></child></obje"
+  "ct><packing><property name=\"position\">1</property></packing></child><"
+  "child internal-child=\"action_area\"><object class=\"GtkHButtonBox\" id"
+  "=\"dialog-action_area1\"><property name=\"visible\">True</property><pro"
+  "perty name=\"layout_style\">end</property><child><object class=\"GtkBut"
+  "ton\" id=\"button2\"><property name=\"label\">gtk-help</property><prope"
+  "rty name=\"visible\">True</property><property name=\"sensitive\">True</"
+  "property><property name=\"can_focus\">True</property><property name=\"r"
+  "eceives_default\">True</property><property name=\"use_stock\">True</pro"
+  "perty></object><packing><property name=\"expand\">False</property><prop"
+  "erty name=\"fill\">False</property><property name=\"position\">0</prope"
+  "rty><property name=\"secondary\">True</property></packing></child><chil"
+  "d><object class=\"GtkButton\" id=\"button1\"><property name=\"label\">g"
+  "tk-close</property><property name=\"visible\">True</property><property "
+  "name=\"can_focus\">True</property><property name=\"receives_default\">T"
+  "rue</property><property name=\"use_stock\">True</property></object><pac"
   "king><property name=\"expand\">False</property><property name=\"fill\">"
-  "False</property><property name=\"position\">11</property></packing></ch"
-  "ild><child><object class=\"GtkLabel\" id=\"label16\"><property name=\"v"
-  "isible\">True</property><property name=\"xalign\">0</property><property"
-  " name=\"label\" translatable=\"yes\">Opacity of popup window_s:</proper"
-  "ty><property name=\"use_underline\">True</property><property name=\"mne"
-  "monic_widget\">popup_opacity_scale</property></object><packing><propert"
-  "y name=\"expand\">False</property><property name=\"fill\">False</proper"
-  "ty><property name=\"position\">12</property></packing></child><child><o"
-  "bject class=\"GtkAlignment\" id=\"alignment9\"><property name=\"visible"
-  "\">True</property><property name=\"top_padding\">2</property><property "
-  "name=\"left_padding\">12</property><child><object class=\"GtkHBox\" id="
-  "\"hbox7\"><property name=\"visible\">True</property><child><object clas"
-  "s=\"GtkLabel\" id=\"label25\"><property name=\"visible\">True</property"
-  "><property name=\"label\" translatable=\"yes\">&lt;i&gt;Transparent&lt;"
-  "/i&gt;</property><property name=\"use_markup\">True</property></object>"
-  "<packing><property name=\"expand\">False</property><property name=\"fil"
-  "l\">False</property><property name=\"position\">0</property></packing><"
-  "/child><child><object class=\"GtkHScale\" id=\"popup_opacity_scale\"><p"
-  "roperty name=\"visible\">True</property><property name=\"can_focus\">Tr"
-  "ue</property><property name=\"update_policy\">discontinuous</property><"
-  "property name=\"adjustment\">adjustment6</property><property name=\"res"
-  "trict_to_fill_level\">False</property><property name=\"draw_value\">Fal"
-  "se</property></object><packing><property name=\"position\">1</property>"
-  "</packing></child><child><object class=\"GtkLabel\" id=\"label26\"><pro"
-  "perty name=\"visible\">True</property><property name=\"label\" translat"
-  "able=\"yes\">&lt;i&gt;Opaque&lt;/i&gt;</property><property name=\"use_m"
-  "arkup\">True</property></object><packing><property name=\"expand\">Fals"
-  "e</property><property name=\"fill\">False</property><property name=\"po"
-  "sition\">2</property></packing></child></object></child></object><packi"
-  "ng><property name=\"expand\">False</property><property name=\"fill\">Fa"
-  "lse</property><property name=\"position\">13</property></packing></chil"
-  "d></object></child></object></child></object></child></object><packing>"
-  "<property name=\"position\">1</property></packing></child></object><pac"
-  "king><property name=\"position\">5</property></packing></child><child t"
-  "ype=\"tab\"><object class=\"GtkLabel\" id=\"label6\"><property name=\"v"
-  "isible\">True</property><property name=\"label\" translatable=\"yes\">C"
-  "_ompositor</property><property name=\"use_underline\">True</property></"
-  "object><packing><property name=\"position\">5</property><property name="
-  "\"tab_fill\">False</property></packing></child></object><packing><prope"
-  "rty name=\"position\">1</property></packing></child><child internal-chi"
-  "ld=\"action_area\"><object class=\"GtkHButtonBox\" id=\"dialog-action_a"
-  "rea1\"><property name=\"visible\">True</property><property name=\"layou"
-  "t_style\">end</property><child><object class=\"GtkButton\" id=\"button2"
-  "\"><property name=\"label\">gtk-help</property><property name=\"visible"
-  "\">True</property><property name=\"sensitive\">True</property><property"
-  " name=\"can_focus\">True</property><property name=\"receives_default\">"
-  "True</property><property name=\"use_stock\">True</property></object><pa"
-  "cking><property name=\"expand\">False</property><property name=\"fill\""
-  ">False</property><property name=\"position\">0</property><property name"
-  "=\"secondary\">True</property></packing></child><child><object class=\""
-  "GtkButton\" id=\"button1\"><property name=\"label\">gtk-close</property"
-  "><property name=\"visible\">True</property><property name=\"can_focus\""
-  ">True</property><property name=\"receives_default\">True</property><pro"
-  "perty name=\"use_stock\">True</property></object><packing><property nam"
-  "e=\"expand\">False</property><property name=\"fill\">False</property><p"
-  "roperty name=\"position\">1</property></packing></child></object><packi"
-  "ng><property name=\"expand\">False</property><property name=\"pack_type"
-  "\">end</property><property name=\"position\">0</property></packing></ch"
-  "ild></object></child><action-widgets><action-widget response=\"-11\">bu"
-  "tton2</action-widget><action-widget response=\"0\">button1</action-widg"
-  "et></action-widgets></object></interface>"
+  "False</property><property name=\"position\">1</property></packing></chi"
+  "ld></object><packing><property name=\"expand\">False</property><propert"
+  "y name=\"pack_type\">end</property><property name=\"position\">0</prope"
+  "rty></packing></child></object></child><action-widgets><action-widget r"
+  "esponse=\"-11\">button2</action-widget><action-widget response=\"0\">bu"
+  "tton1</action-widget></action-widgets></object></interface>"
 };
 
-static const unsigned tweaks_dialog_ui_length = 37803u;
+static const unsigned tweaks_dialog_ui_length = 38296u;
 
diff --git a/xfwm4-4.10.0/src/compositor.c b/xfwm4-4.10.0/src/compositor.c
index c0ce4ea..d9502e6 100644
--- a/xfwm4-4.10.0/src/compositor.c
+++ b/xfwm4-4.10.0/src/compositor.c
@@ -36,6 +36,11 @@
 #include <string.h>
 #include <libxfce4util/libxfce4util.h>
 
+#include <stdint.h>
+#include <fcntl.h>
+#include <errno.h>
+#include <drm.h>
+
 #include "display.h"
 #include "screen.h"
 #include "client.h"
@@ -87,6 +92,9 @@
 
 /* Set TIMEOUT_REPAINT to 0 to disable timeout repaint */
 #define TIMEOUT_REPAINT       10 /* msec.) */
+#define TIMEOUT_REPAINT_MIN    1
+#define TIMEOUT_REPAINT_MAX   20
+#define TIMEOUT_DRI           10 /* seconds */
 
 typedef struct _CWindow CWindow;
 struct _CWindow
@@ -1243,6 +1251,102 @@ paint_win (CWindow *cw, XserverRegion region, gboolean solid_part)
     }
 }
 
+#if TIMEOUT_REPAINT
+
+static void
+open_dri (ScreenInfo *screen_info)
+{
+    const char* dev = "/dev/dri/card0";
+    screen_info->dri_fd = open(dev, O_RDWR);
+    if (screen_info->dri_fd == -1)
+        g_warning ("Error opening %s: %s", dev, strerror(errno));
+}
+
+static void
+close_dri (ScreenInfo *screen_info)
+{
+    close(screen_info->dri_fd);
+    screen_info->dri_fd = -1;
+}
+
+static gboolean
+dri_enabled (ScreenInfo *screen_info)
+{
+    return (screen_info->dri_fd != -1 && screen_info->params->sync_to_vblank);
+}
+
+static void
+wait_vblank (ScreenInfo *screen_info)
+{
+    int retval;
+    drm_wait_vblank_t vblank;
+
+    if (screen_info->dri_time > g_get_monotonic_time())
+        return;
+
+    vblank.request.sequence = 1;
+    vblank.request.type = _DRM_VBLANK_RELATIVE;
+    if (screen_info->dri_secondary)
+        vblank.request.type |= _DRM_VBLANK_SECONDARY;
+
+    do
+    {
+       retval = ioctl(screen_info->dri_fd, DRM_IOCTL_WAIT_VBLANK, &vblank);
+       vblank.request.type &= ~_DRM_VBLANK_RELATIVE;
+    }
+    while (retval == -1 && errno == EINTR);
+
+    screen_info->vblank_time = g_get_monotonic_time();
+
+    if (retval == -1)
+    {
+        if (screen_info->dri_success)
+        {
+            screen_info->dri_success = FALSE;
+            g_warning ("Error waiting on vblank with DRI: %s", strerror(errno));
+        }
+
+        /* if getting the vblank fails, try to get it from the other output */
+        screen_info->dri_secondary = !screen_info->dri_secondary;
+
+        /* the output that we tried to get the vblank from might be disabled,
+           if that's the case, the device needs to be reopened, or it will continue to fail */
+        close_dri(screen_info);
+        open_dri(screen_info);
+
+        /* retry in 10 seconds */
+        screen_info->dri_time = g_get_monotonic_time() + TIMEOUT_DRI * 1000000;
+    }
+    else if (!screen_info->dri_success)
+    {
+        g_message ("Using vertical blank of %s DRI output",
+                screen_info->dri_secondary ? "secondary" : "primary");
+
+        screen_info->dri_success = TRUE;
+    }
+}
+
+#ifdef HAVE_RANDR
+static void
+get_refresh_rate (ScreenInfo* screen_info)
+{
+    gint refresh_rate;
+    XRRScreenConfiguration* randr_info;
+
+    randr_info = XRRGetScreenInfo(screen_info->display_info->dpy, screen_info->xroot);
+    refresh_rate = XRRConfigCurrentRate(randr_info);
+    XRRFreeScreenConfigInfo(randr_info);
+
+    if (refresh_rate != screen_info->refresh_rate)
+    {
+      g_message ("Detected refreshrate:%i hertz", refresh_rate);
+      screen_info->refresh_rate = refresh_rate;
+    }
+}
+#endif
+
+#endif
+
 static void
 paint_all (ScreenInfo *screen_info, XserverRegion region)
 {
@@ -1254,6 +1358,10 @@ paint_all (ScreenInfo *screen_info, XserverRegion region)
     gint screen_height;
     CWindow *cw;
 
+#if TIMEOUT_REPAINT
+    gboolean use_dri;
+#endif
+
     TRACE ("entering paint_all");
     g_return_if_fail (screen_info);
 
@@ -1402,8 +1510,24 @@ paint_all (ScreenInfo *screen_info, XserverRegion region)
     TRACE ("Copying data back to screen");
     /* Set clipping back to the given region */
     XFixesSetPictureClipRegion (dpy, screen_info->rootBuffer, 0, 0, region);
+
+#if TIMEOUT_REPAINT
+    use_dri = dri_enabled(screen_info);
+    /*sync all previous rendering commands, tell xlib to render the pixmap onto the root window,
+      wait for the vblank, then flush, this minimizes tearing*/
+    if (use_dri)
+        XFlush(dpy);
+#endif
     XRenderComposite (dpy, PictOpSrc, screen_info->rootBuffer, None, screen_info->rootPicture,
                       0, 0, 0, 0, 0, 0, screen_width, screen_height);
+#if TIMEOUT_REPAINT
+    if (use_dri)
+    {
+        wait_vblank(screen_info);
+        XFlush(dpy);
+    }
+#endif
+
     XFixesDestroyRegion (dpy, paint_region);
 }
 
@@ -1463,12 +1587,42 @@ static void
 add_repair (ScreenInfo *screen_info)
 {
 #if TIMEOUT_REPAINT
+    gint64 interval;
+
     if (screen_info->compositor_timeout_id != 0)
     {
         return;
     }
+
+    if (dri_enabled(screen_info))
+    {
+        /* schedule the next render to be half a refresh period after the last vertical blank,
+           but at least 1 ms in the future so that all queued events can be processed,
+           and to reduce latency if we didn't render for a while */
+#ifdef HAVE_RANDR
+        if (screen_info->refresh_rate > 0)
+        {
+            interval = (screen_info->vblank_time + 500000 / screen_info->refresh_rate -
+                            g_get_monotonic_time()) / 1000;
+        }
+        else
+#endif
+        {
+            interval = TIMEOUT_REPAINT - ((g_get_monotonic_time() - screen_info->vblank_time) / 1000);
+        }
+
+        if (interval > TIMEOUT_REPAINT_MAX)
+          interval = TIMEOUT_REPAINT_MAX;
+        else if (interval < TIMEOUT_REPAINT_MIN)
+          interval = TIMEOUT_REPAINT_MIN;
+    }
+    else
+    {
+        interval = TIMEOUT_REPAINT;
+    }
+      
     screen_info->compositor_timeout_id =
-        g_timeout_add (TIMEOUT_REPAINT,
+        g_timeout_add (interval,
                        compositor_timeout_cb, screen_info);
 #endif /* TIMEOUT_REPAINT */
 }
@@ -2539,6 +2693,24 @@ compositorHandleShapeNotify (DisplayInfo *display_info, XShapeEvent *ev)
     }
 }
 
+#ifdef HAVE_RANDR
+static void
+compositorHandleRandrNotify (DisplayInfo *display_info, XRRScreenChangeNotifyEvent *ev)
+{
+    ScreenInfo *screen_info;
+
+    g_return_if_fail (display_info != NULL);
+    g_return_if_fail (ev != NULL);
+    TRACE ("entering compositorHandleRandrNotify for 0x%lx", ev->window);
+
+    screen_info = myDisplayGetScreenFromRoot (display_info, ev->window);
+    if (screen_info)
+        get_refresh_rate(screen_info);
+
+    XRRUpdateConfiguration ((XEvent *) ev);
+}
+#endif
+
 static void
 compositorSetCMSelection (ScreenInfo *screen_info, Window w)
 {
@@ -2749,6 +2921,13 @@ compositorHandleEvent (DisplayInfo *display_info, XEvent *ev)
     {
         compositorHandleShapeNotify (display_info, (XShapeEvent *) ev);
     }
+#ifdef HAVE_RANDR
+    else if (ev->type == (display_info->xrandr_event_base + RRScreenChangeNotify))
+    {
+        compositorHandleRandrNotify (display_info, (XRRScreenChangeNotifyEvent *) ev);
+    }
+#endif
+
 #if TIMEOUT_REPAINT == 0
     repair_display (display_info);
 #endif /* TIMEOUT_REPAINT */
@@ -2967,6 +3146,20 @@ compositorManageScreen (ScreenInfo *screen_info)
     compositorSetCMSelection (screen_info, screen_info->xfwm4_win);
     TRACE ("Manual compositing enabled");
 
+    open_dri(screen_info);
+    screen_info->dri_success = TRUE;
+    screen_info->dri_secondary = FALSE;
+    screen_info->dri_time = 0;
+    screen_info->vblank_time = 0;
+
+#ifdef HAVE_RANDR
+    if (display_info->have_xrandr)
+    {
+        get_refresh_rate(screen_info);
+        XRRSelectInput(display_info->dpy, screen_info->xroot, RRScreenChangeNotifyMask);
+    }
+#endif
+
     return TRUE;
 #else
     return FALSE;
@@ -3059,6 +3252,14 @@ compositorUnmanageScreen (ScreenInfo *screen_info)
                                     display_info->composite_mode);
 
     compositorSetCMSelection (screen_info, None);
+
+    close_dri(screen_info);
+
+#ifdef HAVE_RANDR
+    if (display_info->have_xrandr)
+        XRRSelectInput(display_info->dpy, screen_info->xroot, 0);
+#endif
+
 #endif /* HAVE_COMPOSITOR */
 }
 
diff --git a/xfwm4-4.10.0/src/screen.h b/xfwm4-4.10.0/src/screen.h
index 88e4845..8d8ccb3 100644
--- a/xfwm4-4.10.0/src/screen.h
+++ b/xfwm4-4.10.0/src/screen.h
@@ -181,6 +181,17 @@ struct _ScreenInfo
     gboolean damages_pending;
 
     guint compositor_timeout_id;
+
+    gint dri_fd;
+    gboolean dri_secondary;
+    gboolean dri_success;
+    gint64 dri_time;
+    gint64 vblank_time;
+
+#ifdef HAVE_RANDR
+    gint refresh_rate;
+#endif
+
 #endif /* HAVE_COMPOSITOR */
 };
 
diff --git a/xfwm4-4.10.0/src/settings.c b/xfwm4-4.10.0/src/settings.c
index 607bb7b..a8a9e06 100644
--- a/xfwm4-4.10.0/src/settings.c
+++ b/xfwm4-4.10.0/src/settings.c
@@ -720,6 +720,7 @@ loadSettings (ScreenInfo *screen_info)
         {"snap_to_border", NULL, G_TYPE_BOOLEAN, TRUE},
         {"snap_to_windows", NULL, G_TYPE_BOOLEAN, TRUE},
         {"snap_width", NULL, G_TYPE_INT, TRUE},
+        {"sync_to_vblank", NULL, G_TYPE_BOOLEAN, TRUE},
         {"theme", NULL, G_TYPE_STRING, TRUE},
         {"tile_on_move", NULL, G_TYPE_BOOLEAN, TRUE},
         {"title_alignment", NULL, G_TYPE_STRING, TRUE},
@@ -823,6 +824,8 @@ loadSettings (ScreenInfo *screen_info)
         getBoolValue ("snap_resist", rc);
     screen_info->params->snap_width =
         getIntValue ("snap_width", rc);
+    screen_info->params->sync_to_vblank =
+        getBoolValue ("sync_to_vblank", rc);
     screen_info->params->tile_on_move =
         getBoolValue ("tile_on_move", rc);
     screen_info->params->toggle_workspaces =
@@ -1329,6 +1332,10 @@ cb_xfwm4_channel_property_changed(XfconfChannel *channel, const gchar *property_
                 {
                     screen_info->params->tile_on_move = g_value_get_boolean (value);
                 }
+                else if (!strcmp (name, "sync_to_vblank"))
+                {
+                    screen_info->params->sync_to_vblank = g_value_get_boolean (value);
+                }
                 else if (!strcmp (name, "toggle_workspaces"))
                 {
                     screen_info->params->toggle_workspaces = g_value_get_boolean (value);
diff --git a/xfwm4-4.10.0/src/settings.h b/xfwm4-4.10.0/src/settings.h
index be01b6b..d595ddc 100644
--- a/xfwm4-4.10.0/src/settings.h
+++ b/xfwm4-4.10.0/src/settings.h
@@ -223,6 +223,7 @@ struct _XfwmParams
     gboolean snap_resist;
     gboolean snap_to_border;
     gboolean snap_to_windows;
+    gboolean sync_to_vblank;
     gboolean tile_on_move;
     gboolean title_vertical_offset_active;
     gboolean title_vertical_offset_inactive;
